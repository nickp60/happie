[[icon/logo.png]]
* Happie
Happie is a wrapper for several independent programs used to identify different mobile elements.  It is designed to thrive on HPC environments taking advantage of either Docker or Singularity to containerize the different programs.




** Context independent Regions
These regions are interesting in and of themselves for what genes they carry, etc
*** Phages
**** ProphET
*** Plasmids
**** mlplasmids
**** mobsuite
**** PlasFlow
*** Genomic Islands
**** CAFE
# ** Context-dependedt Regions
# These regions are short, and are interestesitng solely because of their context
# *** Insertion Sequnes
# **** OASIS

**** Islandpath DIMOB

* Install

Happie can manually be installed from github as follows

#+begin_src
git clone https://github.com/nickp60/happie
cd happie
conda create -n happie  biopython pyyaml
source activate happie
python setup.py install
happie_install_or_update
#+end_src

That is going to take care of downloading Docker images for  [[link][ProphET]], [[link][prokka]], [[link][mlplasmids]], [[link][dimob]], [[https://github.com/phac-nml/mob-suite][mobsuite]], [[https://github.com/smaegol/PlasFlow][PlasFlow]].  If you are running singularity, a folder called `.happie` will be created in your home directory.

* Running
(Optional) get some test data:

#+begin_src
bash ./get_test_data.sh
#+end_src

And try running it!

#+begin_src
happie --contigs ./test_data/ecoli104.fna  --output tmpresults
#+end_src

Or, if you are using singularity:
#+begin_src
happie --contigs ./test_data/ecoli104.fna  --output tmpresults --virtualization singularity
#+end_src

You should get several output files:
#+begin_src
tmp
├── ProphET
├── PropheET_log.txt
├── abricate
├── abricate_resfinder_log.txt
├── abricate_vfdb_log.txt
├── cgview.tab
├── dimob
├── log.txt
├── mlplasmids
├── mlplasmids_log.txt
├── mobile_prokka
├── mobile_genome.fasta
├── mobile_genome.gbk
├── mobile_genome_coords
├── mobsuite
├── names_key
├── new_fasta.fasta
└── prokka
#+end_src



*  Stages
Happie does the following things:
** 0) *QC*.
Happie removes short contigs and renames the contig names (to avoid issues with too-long names, non-standatd characters). The `names_key` file provides a link between the original names and the clean names.
** 1) Reannotates fasta with Prokka.
This ensures that the annotations are all the same format, which is useful for the pipelines that reference the annotations (like ProphET).

** 2) Identify Mobile Elements

*** Plasmids
If working with appropriate organisms, [[link][mlplasmids]] is your best. Otherwise, go with PlasFlow.  If you are feeling adventurous, try mob-suite, but use with caution.

*** Genomic Islands
Originally I was working on incorporating CAFE, but I later found out that it is not designed to handle certain organisms.  So, We went with IslandPath-DIMOB.

*** Prophages
See the short version of our head-to-head comparison here: [[https://nickp60.github.io/weird_one_offs/testing_3_prophage_finders/][Testing 3 Prophage Finders]].

** Extract Mobile Elements

** Assess features of Mobile Elements vs Chromosome
*** Abricate
**** VFDB
**** resfinder
*** AntiSmash
In Progress

*** Note
This module was renamed from "mobilephone", it was just too hard to google.
